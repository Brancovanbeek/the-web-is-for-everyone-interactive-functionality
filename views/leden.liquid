{% render 'partials/head.liquid' %}

<main>





    <section class="page-title-container">
        <section class="page-title">
            <a class="subtext" href="/">
                <img src="/img/arrow-left.svg" alt="">TERUG NAAR HOME
            </a>
            <h1>ONZE LEDEN</h1>
        </section>
        
        <section class="page-title-content">
            <h6>De {{ leden | size }} beste digitale bureaus van Nederland zijn verenigd in Dutch Digital Agencies. Zet de juiste filters aan en zoek contact met het bureau dat het beste bij past bij jouw vraagstuk en uitdaging. Ook DDA lid worden? Ga dan naar deze pagina voor meer informatie.</h6>
        </section>
    </section>
    <section class="filter-container">
        <section class="search-bar">
            <input type="text" placeholder="Zoek een bureau..." id="search" name="search">
        </section>
        
        <form class="filters" method="get" action="/leden">
            <!-- Provincie filter -->
            <section class="provincie-filter">
                <select class="subtext" name="provincie" id="provincie">
                    <option value="">PROVINCIES</option>
                    <option value="Noord-Holland">Noord-Holland</option>
                    <option value="Zuid-Holland">Zuid-Holland</option>
                    <option value="Groningen">Groningen</option>
                    <option value="Friesland">Friesland</option>
                    <option value="Drenthe">Drenthe</option>
                    <option value="Overijssel">Overijssel</option>
                    <option value="Flevoland">Flevoland</option>
                    <option value="Gelderland">Gelderland</option>
                    <option value="Utrecht">Utrecht</option>
                    <option value="Limburg">Limburg</option>
                    <option value="Noord-Brabant">Noord-Brabant</option>
                    <option value="Zeeland">Zeeland</option>
                </select>  

                <span class="select-button-icon">
                    <img src="/img/plus.svg" alt="">
                </span>                 
            </section>

            <!-- Omvang filter -->
            <section class="omvang-filter">
                <select class="subtext" name="omvang" id="omvang">
                    <option value="">OMVANG</option>
                    <option value="1-9">1-9</option>
                    <option value="10-24">10-24</option>
                    <option value="25-49">25-49</option>
                    <option value="50-99">50-99</option>
                    <option value="100-249">100-249</option>
                    <option value="250+">250+</option>
                </select>  
                <span class="select-button-icon">
                    <img src="/img/plus.svg" alt="">
                </span>      
            </section>

            <!-- Sorteren filter -->
            <section class="sorteren-filter">
                <select class="subtext" name="sorteren" id="sorteren">
                    <option value="">SORTEREN</option>
                    <option value="az">A-Z</option>
                    <option value="za">Z-A</option>
                    <option value="colleagues">Aantal werknemers</option>
                </select>
                <span class="select-button-icon">
                    <img src="/img/plus.svg" alt="">
                </span>    
            </section>   

            <button class="subtext" id="filter-submit-button"   type="submit">SUBMIT</button>
        </form>
    </section>

    <section class="leden-card-grid">
    {% for lid in leden %}
      <section class="leden-card">
        <img loading="lazy" alt="{{ lid.title }}" src="https://fdnd-agency.directus.app/assets/{{ lid.photo }}" width="200">
        <h3>{{ lid.title | upcase }}</h3>
        <p class="subtext">{{ lid.address | split: " " | last | upcase }}</p>
        <p class="subtext">{{ lid.colleagues | upcase }} WERKNEMER{% if lid.colleagues > 1%}S{% endif %}</p>
        <a href="/leden/lid/{{ lid.id }}">DETAILS
            <img src="/img/arrow.svg" alt="">
        </a>
      </section>
    {% endfor %}
    </section>

    <div class="loader"></div>


   <section class="lid-toevoegen-container">
        <details class="subtext">
            <summary>Lid toevoegen</summary>
            <form class="lid-toevoegen-form" action="/leden/nieuw/toevoegen" method="POST" data-enhanced="form">
                <label class="subtext" for="title">Agency Name</label>
                <input placeholder="Funda" name="title" type="text">
        
                <label class="subtext" for="address">Agency Location</label>
                <input placeholder="Amsterdam"  name="address" type="text">
        
                <label class="subtext" for="colleagues">Agency Employees</label> 
                <input placeholder="80" name="colleagues" type="text">
        
                <button class="subtext" type="submit">SUBMIT</button>
            </form>   
        </details>
   </section>



    {% if request.query.succes %}
        <div class="succes-melding">
          {{ request.query.succes }}
        </div>
      {% endif %}
      
      {% if request.query.error %}
        <div class="error-melding">
          {{ request.query.error }}
        </div>
    {% endif %}
      
    

</main>

<script src="/scripts/script.js"></script>

<script type="module">
// We maken hieronder aannames over wat de browser ondersteunt
if ('fetch' in window && 'DOMParser' in window) {

  document.addEventListener('submit', async function(event) {
    const form = event.target;

    // Als dit formulier geen data-enhanced attribuut heeft, doe dan niks
    if (!form.hasAttribute('data-enhanced')) {
      return;
    }

    const loader = document.querySelector('.loader');
    event.preventDefault();
    loader.classList.add('show');

    try {
      // Doe een fetch naar de server, met de gegevens van het formulier
      const response = await fetch(form.action, {
        method: form.method,
        body: new URLSearchParams(new FormData(form)),
      });

      const data = await response.json();  // Verwerk de JSON response van de server

      // Als de server succes heeft geretourneerd
      if (data.success) {
        // Verwerk de nieuwe data (bijvoorbeeld de lijst van leden)
        const newState = document.querySelector('[data-enhanced="' + form.getAttribute('data-enhanced') + '"]');
        // Update de UI met de succesboodschap
        alert(data.message);
        form.reset();  // Reset het formulier

        // Vervang de formulier HTML met een successtatus
        form.outerHTML = newState.outerHTML;
      } else {
        // Laat een foutmelding zien als de server een fout heeft geretourneerd
        alert(data.message);
      }
    } catch (error) {
      console.error('Error during form submission:', error);
      alert('Er is een fout opgetreden tijdens het verzenden.');
    } finally {
      loader.classList.remove('show');
    }
  });
}
</script>


{% render 'partials/foot.liquid' %}